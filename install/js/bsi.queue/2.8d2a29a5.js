(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{HyLJ:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-dashboard"},[a("div",{staticClass:"c-dashboard__panel"},[a("app-time-picker",{on:{change:e.handleTimePresetChange},model:{value:e.timePreset,callback:function(t){e.timePreset=t},expression:"timePreset"}}),e._v(" "),a("app-refresh-picker",{attrs:{title:e.$t("tooltip.autoUpdate")},model:{value:e.refresh,callback:function(t){e.refresh=t},expression:"refresh"}})],1),e._v(" "),a("el-row",{attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:e.$t("title.status")}},[e.init?a("stat-panel",{attrs:{type:e.hasConsumers?"success":"danger",title:e.hasConsumers?"":e.$t("tooltip.notFoundConsumers")}},[e._v("\n                    "+e._s(e.hasConsumers?e.$t("label.ok"):e.$t("label.problem"))+"\n                ")]):a("stat-panel",[e._v("\n                    -\n                ")])],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:e.$t("title.consumers")}},[a("stat-panel",[e._v("\n                    "+e._s(e.summary.consumers?e.summary.consumers.toLocaleString():0)+"\n                ")])],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:e.$t("enums.status.sent")}},[a("stat-panel",{attrs:{type:"info"}},[e._v("\n                    "+e._s(e.summary.sent?e.summary.sent.toLocaleString():0)+"\n                ")])],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:e.$t("enums.status.received")}},[a("stat-panel",{attrs:{type:"warning"}},[e._v("\n                    "+e._s(e.summary.received?e.summary.received.toLocaleString():0)+"\n                ")])],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:e.$t("enums.status.handled")}},[a("stat-panel",{attrs:{type:"success"}},[e._v("\n                    "+e._s(e.summary.handled?e.summary.handled.toLocaleString():0)+"\n                ")])],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:e.$t("enums.status.failed")}},[a("stat-panel",{attrs:{type:"danger"}},[e._v("\n                    "+e._s(e.summary.failed?e.summary.failed.toLocaleString():0)+"\n                ")])],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:24}},[a("dashboard-panel",{attrs:{title:e.$t("title.stats")}},[a("chart-panel",{attrs:{series:e.chartSeries,options:e.chartOptions,height:"300px"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:24}},[a("dashboard-panel",{attrs:{title:e.$t("title.messages")}},[a("recent-messages-panel",{attrs:{data:e.recentMessages.data,total:e.recentMessages.total,"page-size":e.recentMessages.pageSize},on:{"message-select":e.handleMessageSelect,paginate:e.handleRecentMessagesPaginate,"page-size-change":e.handleRecentMessagesPageSizeChange,search:e.handleRecentMessagesSearch}})],1)],1)],1),e._v(" "),e.drawerMessage?a("el-drawer",{attrs:{title:e.drawerMessage.message,visible:e.drawer,"destroy-on-close":"",size:"70%","custom-class":"c-drawer"},on:{"update:visible":function(t){e.drawer=t},closed:e.handleDrawerClosed}},[a("message-details",{attrs:{data:e.drawerMessage}})],1):e._e()],1)};s._withStripped=!0;a("4mDm"),a("2B1R"),a("qePV"),a("07d7"),a("5s+n"),a("rB9j"),a("PKPk"),a("hByQ"),a("3bBZ"),a("R5XZ");var r=a("o0o1"),n=a.n(r),i=(a("ls82"),a("yXPU")),l=a.n(i),o={props:{initial:{type:Object,default:function(){return{}}}}},c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-time-picker"},[a("el-dropdown",{on:{command:e.handleCommand}},[a("el-button",{attrs:{type:"default"}},[a("i",{staticClass:"el-icon-time el-icon--left"}),e._v(e._s(e.currentPreset.name)),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.enabledPresets,(function(t){return a("el-dropdown-item",{key:t.id,attrs:{command:t.id}},[e._v("\n                "+e._s(t.name)+"\n                "),t.id===e.value?a("i",{staticClass:"el-icon-check el-icon--right"}):e._e()])})),1)],1)],1)};c._withStripped=!0;a("fbCW");var u={props:{value:{type:String,required:!0},presets:{type:Array,default:function(){return[]}}},data:function(){return{allPresets:[{id:"-5 minutes",name:this.$t("enums.datePreset.last5m")},{id:"-15 minutes",name:this.$t("enums.datePreset.last15m")},{id:"-30 minutes",name:this.$t("enums.datePreset.last30m")},{id:"-1 hours",name:this.$t("enums.datePreset.last1h")},{id:"-3 hours",name:this.$t("enums.datePreset.last3h")},{id:"-6 hours",name:this.$t("enums.datePreset.last6h")},{id:"-12 hours",name:this.$t("enums.datePreset.last12h")},{id:"-24 hours",name:this.$t("enums.datePreset.last24h")},{id:"-2 days",name:this.$t("enums.datePreset.last2d")},{id:"-7 days",name:this.$t("enums.datePreset.last7d")},{id:"-30 days",name:this.$t("enums.datePreset.last30d")},{id:"-60 days",name:this.$t("enums.datePreset.last60d")},{id:"-90 days",name:this.$t("enums.datePreset.last90d")},{id:"-6 months",name:this.$t("enums.datePreset.last6M")},{id:"-1 year",name:this.$t("enums.datePreset.last1y")}]}},computed:{currentPreset:function(){var e=this;return this.allPresets.find((function(t){return t.id===e.value}))},enabledPresets:function(){var e=this;return 0===this.presets.length?this.allPresets:this.presets.map((function(t){return e.allPresets.find((function(e){return e.id===t}))}))}},methods:{handleCommand:function(e){this.$emit("input",e),this.$emit("change",e)}}},d=a("KHd+"),h=Object(d.a)(u,c,[],!1,null,null,null);h.options.__file="assets/components/AppTimePicker.vue";var p=h.exports,m=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"c-refresh-picker"},[t("el-button",{attrs:{type:this.value?"primary":"default"},on:{click:this.handleClick}},[t("i",{staticClass:"el-icon-refresh"})])],1)};m._withStripped=!0;var f={props:{value:{type:Boolean,required:!0}},methods:{handleClick:function(){this.$emit("input",!this.value)}}},v=Object(d.a)(f,m,[],!1,null,null,null);v.options.__file="assets/components/AppRefreshPicker.vue";var _=v.exports,g=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"c-dashboard-panel"},[t("div",{staticClass:"c-dashboard-panel__header"},[t("div",{staticClass:"c-dashboard-panel__title"},[this._v("\n            "+this._s(this.title)+"\n        ")])]),this._v(" "),t("div",{staticClass:"c-dashboard-panel__content"},[this._t("default",[this._m(0)])],2)])};g._withStripped=!0;var y={props:{title:{type:String,default:""}}},b=Object(d.a)(y,g,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"c-dashboard-panel__stub"},[t("i",{staticClass:"el-icon-s-data"}),this._v(" "),t("div",[this._v("Нет данных")])])}],!1,null,null,null);b.options.__file="assets/components/DashboardPanel.vue";var P=b.exports,w=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"c-stat-panel",class:this.type?"c-stat-panel--"+this.type:""},[t("div",{staticClass:"c-stat-panel__value"},[this._t("default")],2)])};w._withStripped=!0;var S={props:{type:{type:String,default:""}}},$=Object(d.a)(S,w,[],!1,null,null,null);$.options.__file="assets/components/StatPanel.vue";var C=$.exports,x=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"c-chart-panel"},[t("apexchart",{attrs:{type:"area",options:this.mergedOptions,series:this.series,width:"98%",height:this.height}})],1)};x._withStripped=!0;a("QWBl"),a("J30X"),a("zKZe"),a("tkto"),a("FZtP");var M=a("lSNA"),D=a.n(M),k=a("cDf5"),j=a.n(k),z=a("EyHm"),O=a.n(z),A=a("zkkH"),T={components:{apexchart:O.a},props:{series:{type:Array,required:!0},options:{type:Object,required:!1,default:function(){return{}}},height:{type:String,default:"auto"}},data:function(){return{defaultOptions:{chart:{locales:[A],defaultLocale:"ru",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},tooltip:{shared:!0,x:{format:"dd.MM.yyyy HH:mm:ss"}},stroke:{curve:"straight",width:2},fill:{type:"solid",opacity:.4},xaxis:{type:"datetime",labels:{datetimeUTC:!1}},yaxis:{decimalsInFloat:!1}}}},computed:{mergedOptions:function(){return this.extend(this.defaultOptions,this.options)}},methods:{isObject:function(e){return e&&"object"===j()(e)&&!Array.isArray(e)},extend:function(e,t){var a=this,s=Object.assign({},e);return this.isObject(e)&&this.isObject(t)&&Object.keys(t).forEach((function(r){a.isObject(t[r])&&r in e?s[r]=a.extend(e[r],t[r]):Object.assign(s,D()({},r,t[r]))})),s}}},R=Object(d.a)(T,x,[],!1,null,null,null);R.options.__file="assets/components/ChartPanel.vue";var q=R.exports,E=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-table-panel"},[a("div",{staticClass:"c-table-panel__search"},[a("el-input",{attrs:{placeholder:e.$t("label.findMessages")},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("table",{staticClass:"c-table"},[a("thead",[a("tr",[a("th",{staticStyle:{width:"140px"}},[e._v("\n                    "+e._s(e.$t("label.sent_at"))+"\n                ")]),e._v(" "),a("th",[e._v("\n                    "+e._s(e.$t("label.message"))+"\n                ")]),e._v(" "),a("th",{staticStyle:{width:"140px"}},[e._v("\n                    "+e._s(e.$t("label.status"))+"\n                ")]),e._v(" "),a("th",{staticStyle:{width:"200px"}},[e._v("\n                    "+e._s(e.$t("label.transport_name"))+"\n                ")]),e._v(" "),a("th",[e._v("\n                    "+e._s(e.$t("label.buses"))+"\n                ")])])]),e._v(" "),a("tbody",[e._l(e.data,(function(t,s){return a("tr",{key:s},[a("td",[e._v("\n                    "+e._s(e.formatDate(t.sent_at))+"\n                ")]),e._v(" "),a("td",[a("a",{staticClass:"c-link",on:{click:function(a){return a.preventDefault(),e.handleMessageSelect(t)}}},[e._v("\n                        "+e._s(t.message)+"\n                    ")])]),e._v(" "),a("td",[a("el-tag",{attrs:{type:e.getStatusType(t.status),"disable-transitions":""}},[e._v("\n                        "+e._s(e.$t("enums.status."+t.status))+"\n                    ")])],1),e._v(" "),a("td",[e._v("\n                    "+e._s(t.transport_name)+"\n                ")]),e._v(" "),a("td",[e._v("\n                    "+e._s(Array.isArray(t.buses)?t.buses.join(", "):"")+"\n                ")])])})),e._v(" "),0===e.data.length?a("tr",[a("td",{staticStyle:{"text-align":"center"},attrs:{colspan:"5"}},[e._v("\n                    Нет данных\n                ")])]):e._e()],2)]),e._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes",total:e.total,"page-size":e.currentPageSize,"page-sizes":e.pageSizes},on:{"update:pageSize":function(t){e.currentPageSize=t},"update:page-size":function(t){e.currentPageSize=t},"current-change":e.handlePageChange,"size-change":e.handlePageSizeChange}})],1)};E._withStripped=!0;a("DQNa");var L={props:{data:{type:Array,required:!0},total:{type:Number,required:!0},pageSize:{type:Number,default:10},pageSizes:{type:Array,default:function(){return[10,20,50]}},searchDelay:{type:Number,default:300}},data:function(){return{search:"",searchTimeout:null}},computed:{currentPageSize:{get:function(){return this.pageSize},set:function(e){this.$emit("update:pageSize",e)}}},watch:{search:function(e){var t=this;this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((function(){t.$emit("search",e)}),this.searchDelay)}},methods:{getStatusType:function(e){return"failed"===e?"danger":"received"===e?"warning":"handled"===e?"success":"info"},formatDate:function(e){return new Date(e).toLocaleString()},handleMessageSelect:function(e){this.$emit("message-select",e)},handlePageChange:function(e){this.$emit("paginate",e)},handlePageSizeChange:function(e){this.$emit("page-size-change",e)}}},B=Object(d.a)(L,E,[],!1,null,null,null);B.options.__file="assets/components/RecentMessagesPanel.vue";var I=B.exports,N=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-message-details c-dashboard"},[a("el-row",{attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:12}},[a("dashboard-panel",{attrs:{title:e.$t("title.summary")}},[a("div",{staticClass:"c-message-details__summary"},e._l(e.summaryProps,(function(t,s){return a("el-row",{key:s,attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:8}},[e._v("\n                            "+e._s(t.name)+"\n                        ")]),e._v(" "),a("el-col",{attrs:{span:16}},[e._v("\n                            "+e._s(t.value)+"\n                        ")])],1)})),1)])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("dashboard-panel",{attrs:{title:e.$t("title.data")}},[a("div",{staticClass:"c-message-details__data"},[a("vue-json-pretty",{attrs:{data:e.prettyData}})],1)])],1)],1),e._v(" "),e.data.error?a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:24}},[a("dashboard-panel",{attrs:{title:e.$t("title.errors")}},[a("table",{staticClass:"c-table c-table--striped"},[a("tbody",e._l(e.errorRows,(function(t,s){return a("tr",{key:s},[a("td",[e._v("\n                                "+e._s(t)+"\n                            ")])])})),0)])])],1)],1):e._e()],1)};N._withStripped=!0;a("TeQF"),a("oVuX"),a("EnZy");var U=a("1Tjy"),F=a.n(U),H=a("29ZS"),Q=a.n(H),Z={components:{VueJsonPretty:F.a,DashboardPanel:P},props:{data:{type:Object,required:!0}},computed:{summaryProps:function(){return[{name:this.$t("label.uuid"),value:this.data.uuid},{name:this.$t("label.transport_name"),value:this.data.transport_name},{name:this.$t("label.buses"),value:Array.isArray(this.data.buses)?this.data.buses.join(", "):null},{name:this.$t("label.sent_at"),value:this.formatDate(this.data.sent_at)},{name:this.$t("label.received_at"),value:this.data.received_at?this.formatDate(this.data.received_at):null},{name:this.$t("label.handled_at"),value:this.data.handled_at?this.formatDate(this.data.handled_at):null},{name:this.$t("label.failed_at"),value:this.data.failed_at?this.formatDate(this.data.failed_at):null}].filter((function(e){return null!==e.value&&void 0!==e.value&&""!==e.value}))},prettyData:function(){return Q()(this.data.data)},errorRows:function(){return this.data.error.split(/\r?\n/)}},methods:{formatDate:function(e){return new Date(e).toLocaleString()}}},J=Object(d.a)(Z,N,[],!1,null,null,null);J.options.__file="assets/components/MessageDetails.vue";var X=J.exports,K=a("vDqi"),V=a.n(K),W=a("Qyje"),G=a.n(W),Y=a("fQM+"),ee=a.n(Y),te=V.a.create({timeout:3e4});te.interceptors.request.use((function(e){return e.headers["X-Bitrix-Csrf-Token"]=ee.a.bitrix_sessid(),e}),(function(e){return console.error(e),Promise.reject(e)})),te.interceptors.response.use((function(e){var t=e.data;return"object"===j()(t)&&"error"===t.status?Array.isArray(t.errors)&&t.errors.length>0?Promise.reject(new Error(t.errors.map((function(e){return e.message})).join("\n"))):Promise.reject(new Error("Error")):t.data}),(function(e){return console.error(e),Promise.reject(e)}));var ae=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e||0===e.length)throw new TypeError('Invalid argument "endpoint"');return te({url:"/bitrix/services/main/ajax.php",method:"post",params:{action:e},data:G.a.stringify(t,{arrayFormat:"indices"})})},se={components:{AppTimePicker:p,AppRefreshPicker:_,DashboardPanel:P,StatPanel:C,ChartPanel:q,RecentMessagesPanel:I,MessageDetails:X},mixins:[o],data:function(){return{timePreset:"-1 hours",refresh:!1,refreshTimer:null,refreshDelay:1e4,init:!1,summary:{},chartSeries:[],chartOptions:{colors:["#909399","#E6A23C","#67C23A","#F56C6C"],yaxis:{forceNiceScale:!0,min:0}},recentMessages:{data:[],total:0,pageSize:10,page:1,search:""},drawer:!1,drawerMessage:null}},computed:{hasConsumers:function(){return this.summary.consumers&&Number(this.summary.consumers)>0}},watch:{refresh:function(e){localStorage["bsi.queue.dashboard.refresh"]=e,this.initAutoUpdate()}},created:function(){var e=this,t=localStorage.getItem("bsi.queue.dashboard.timePreset");t&&(this.timePreset=t),"true"===localStorage.getItem("bsi.queue.dashboard.refresh")&&(this.refresh=!0),this.fetchData().then((function(){e.init=!0}))},beforeDestroy:function(){clearInterval(this.refreshTimer)},methods:{fetchData:function(){return Promise.all([this.fetchSummaryData(),this.fetchChartData(),this.fetchRecentMessagesData()])},fetchSummaryData:function(){var e=this;return l()(n.a.mark((function t(){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ae("bsi:queue.api.dashboard.summary",{from:e.timePreset,to:"now"});case 2:e.summary=t.sent;case 3:case"end":return t.stop()}}),t)})))()},fetchChartData:function(){var e=this;return l()(n.a.mark((function t(){var a;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ae("bsi:queue.api.dashboard.queryRange",{from:e.timePreset,to:"now"});case 2:a=t.sent,e.chartSeries=a.map((function(t){return{name:e.$t("enums.status.".concat(t.status)),data:t.values.map((function(e){return e[0]*=1e3,e}))}}));case 4:case"end":return t.stop()}}),t)})))()},fetchRecentMessagesData:function(){var e=this;return l()(n.a.mark((function t(){var a;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ae("bsi:queue.api.dashboard.recentMessages",{from:e.timePreset,to:"now",pageSize:e.recentMessages.pageSize,page:e.recentMessages.page,search:e.recentMessages.search});case 2:a=t.sent,e.recentMessages.data=a.data,e.recentMessages.total=a.total;case 5:case"end":return t.stop()}}),t)})))()},initAutoUpdate:function(){!0===this.refresh?this.refreshTimer=setInterval(this.autoUpdate,this.refreshDelay):clearInterval(this.refreshTimer)},autoUpdate:function(){this.fetchData()},handleTimePresetChange:function(e){localStorage["bsi.queue.dashboard.timePreset"]=e,this.fetchData()},handleMessageSelect:function(e){this.drawerMessage=e,this.drawer=!0},handleRecentMessagesPaginate:function(e){this.recentMessages.page=e,this.fetchRecentMessagesData()},handleRecentMessagesPageSizeChange:function(e){this.recentMessages.pageSize=e,this.recentMessages.page=1,this.fetchRecentMessagesData()},handleRecentMessagesSearch:function(e){this.recentMessages.search=e,this.fetchRecentMessagesData()},handleDrawerClosed:function(){this.drawerMessage=null}}},re=Object(d.a)(se,s,[],!1,null,null,null);re.options.__file="assets/views/Dashboard.vue";t.default=re.exports}}]);